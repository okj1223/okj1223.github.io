---
layout: default
---

<!-- 상세 페이지 본문 시작 -->
<section class="project-hero">
  <div class="container">
    <h1 class="project-title">{{ page.title }}</h1>
    {% if page.description %}
      <p class="project-subtitle">{{ page.description }}</p>
    {% endif %}
  </div>
</section>

<section class="project-overview">
  <div class="container project-layout">
    <!-- 본문 영역 -->
    <main class="project-content">
      {{ content }}

      {% if page.video_url %}
      <div class="video-inline">
        <h2>Demo Video</h2>
        <div class="video-wrapper">
          <iframe
            src="{{ page.video_url }}"
            title="{{ page.title }}"
            frameborder="0"
            allowfullscreen>
          </iframe>
        </div>
      </div>
      {% endif %}
    </main>

    <!-- 자동 TOC 사이드바 -->
    <aside class="project-toc" id="toc-sidebar">
      <h4>📋 Contents</h4>
      <nav id="toc-nav">
        <!-- TOC가 여기에 자동 생성됩니다 -->
      </nav>
    </aside>
  </div>
</section>

<section class="project-back">
  <div class="container">
    <a href="{{ '/projects/' | relative_url }}" class="button">
      &larr; Back to Projects
    </a>
  </div>
</section>

<!-- 자동 TOC 생성 JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tocNav = document.getElementById('toc-nav');
  const content = document.querySelector('.project-content');
  
  if (!tocNav || !content) return;
  
  // h2, h3, h4 헤딩 찾기
  const headings = content.querySelectorAll('h2, h3, h4');
  
  if (headings.length === 0) {
    document.getElementById('toc-sidebar').style.display = 'none';
    return;
  }
  
  // TOC HTML 생성
  let tocHTML = '<ul class="toc-list">';
  
  headings.forEach((heading, index) => {
    // 고유 ID 생성 (없으면)
    if (!heading.id) {
      // 제목에서 특수문자 제거하고 kebab-case로 변환
      const text = heading.textContent.trim()
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '') // 특수문자 제거
        .replace(/\s+/g, '-')         // 공백을 하이픈으로
        .replace(/-+/g, '-')          // 연속 하이픈 제거
        .replace(/^-|-$/g, '');       // 앞뒤 하이픈 제거
      
      heading.id = text || 'heading-' + index;
    }
    
    // 헤딩 레벨 확인
    const level = parseInt(heading.tagName.charAt(1));
    const text = heading.textContent.trim();
    
    // 이모지 제거 (TOC에서는 깔끔하게)
    const cleanText = text.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
    
    tocHTML += `<li class="toc-item toc-level-${level}">
      <a href="#${heading.id}" class="toc-link" data-target="${heading.id}">${cleanText}</a>
    </li>`;
  });
  
  tocHTML += '</ul>';
  tocNav.innerHTML = tocHTML;
  
  // 스무스 스크롤 이벤트
  const tocLinks = tocNav.querySelectorAll('.toc-link');
  tocLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('data-target');
      const target = document.getElementById(targetId);
      
      if (target) {
        const offsetTop = target.getBoundingClientRect().top + window.pageYOffset - 100;
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      }
    });
  });
  
  // 스크롤 시 현재 섹션 하이라이트
  function updateActiveLink() {
    let current = '';
    const scrollPos = window.pageYOffset + 150;
    
    headings.forEach(heading => {
      const offsetTop = heading.offsetTop;
      if (offsetTop <= scrollPos) {
        current = heading.id;
      }
    });
    
    // 활성 링크 업데이트
    tocLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('data-target') === current) {
        link.classList.add('active');
      }
    });
  }
  
  // 스크롤 이벤트 (throttled)
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      requestAnimationFrame(function() {
        updateActiveLink();
        ticking = false;
      });
      ticking = true;
    }
  });
  
  // 초기 활성 링크 설정
  updateActiveLink();
});
</script>

<style>
/* 📋 TOC와 프로젝트 레이아웃 스타일 */
.project-layout {
  display: flex;
  gap: 2rem;
  max-width: 1400px;
  margin: 0 auto;
  align-items: flex-start;
}

.project-content {
  flex: 1;
  min-width: 0;
  /* 본문은 왼쪽 정렬 유지 */
  text-align: left;
}

/* 📊 표와 그림만 센터 정렬 */
.project-content table {
  margin: 2rem auto !important;
  text-align: center;
}

.project-content figure {
  display: block;
  text-align: center !important;
  margin: 2rem auto !important;
}

.project-content figure img {
  display: block;
  margin: 0 auto;
}

.project-content .video-wrapper {
  margin: 2rem auto !important;
}

/* TOC 사이드바 */
.project-toc {
  width: 280px;
  position: sticky;
  top: 120px;
  max-height: calc(100vh - 140px);
  overflow-y: auto;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(127, 179, 211, 0.2);
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(127, 179, 211, 0.15);
  flex-shrink: 0;
}

.project-toc h4 {
  margin: 0 0 1rem 0;
  font-size: 1rem;
  font-weight: 600;
  color: #5d737e;
  border-bottom: 2px solid #7fb3d3;
  padding-bottom: 0.5rem;
}

/* TOC 리스트 스타일 */
.toc-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.toc-item {
  margin-bottom: 0.2rem;
}

.toc-link {
  display: block;
  padding: 0.4rem 0.8rem;
  color: #5d737e;
  text-decoration: none;
  font-size: 0.85rem;
  line-height: 1.4;
  border-radius: 6px;
  transition: all 0.3s ease;
  border-left: 3px solid transparent;
}

.toc-link:hover {
  background: rgba(127, 179, 211, 0.1);
  color: #7fb3d3;
  border-left-color: #7fb3d3;
  transform: translateX(3px);
}

.toc-link.active {
  background: rgba(127, 179, 211, 0.15);
  color: #7fb3d3;
  font-weight: 500;
  border-left-color: #7fb3d3;
}

/* 헤딩 레벨별 들여쓰기 */
.toc-level-2 .toc-link {
  padding-left: 0.8rem;
  font-weight: 500;
  font-size: 0.9rem;
}

.toc-level-3 .toc-link {
  padding-left: 1.6rem;
  font-size: 0.8rem;
  opacity: 0.9;
}

.toc-level-4 .toc-link {
  padding-left: 2.4rem;
  font-size: 0.75rem;
  opacity: 0.8;
}

/* 모바일 반응형 */
@media (max-width: 1024px) {
  .project-layout {
    flex-direction: column;
  }
  
  .project-toc {
    width: 100%;
    position: static;
    max-height: none;
    order: -1; /* 모바일에서는 상단에 표시 */
  }
  
  .project-toc h4 {
    text-align: center;
  }
  
  /* 모바일에서는 TOC를 접을 수 있게 */
  .toc-list {
    max-height: 200px;
    overflow-y: auto;
  }
}

@media (max-width: 768px) {
  .project-layout {
    padding: 1rem;
    gap: 1rem;
  }
  
  .toc-link {
    font-size: 0.8rem;
    padding: 0.3rem 0.6rem;
  }
  
  .toc-level-3 .toc-link,
  .toc-level-4 .toc-link {
    padding-left: 1.2rem;
  }
}

/* TOC 스크롤바 스타일 */
.project-toc::-webkit-scrollbar {
  width: 4px;
}

.project-toc::-webkit-scrollbar-track {
  background: rgba(127, 179, 211, 0.1);
  border-radius: 2px;
}

.project-toc::-webkit-scrollbar-thumb {
  background: #7fb3d3;
  border-radius: 2px;
}

.project-toc::-webkit-scrollbar-thumb:hover {
  background: #87ceeb;
}

/* 본문 내용이 TOC보다 우선시되도록 */
.project-content h2,
.project-content h3,
.project-content h4 {
  scroll-margin-top: 120px; /* 스크롤 시 헤더 공간 확보 */
}

/* 본문 텍스트는 왼쪽 정렬 유지 */
.project-content p,
.project-content ul,
.project-content ol,
.project-content blockquote {
  text-align: left;
}

/* 코드 블록은 왼쪽 정렬 */
.project-content pre,
.project-content code {
  text-align: left;
}
</style>